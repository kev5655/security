<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <input type="number" placeholder="Type something...">
    <button id="sendBtn">Send</button>
    <a id="output"></a>

    <script type="module">
        import init, { encrypt } from "./pkg/my_wasm_lib.js";
        let clientKey = new Uint8Array()

        await init(); // Ensure WASM is initialized

        async function sendInput() {
            const input = document.querySelector('input[type="number"]').value;
            const inputInt = parseInt(input, 10);
            const result = encrypt(inputInt, clientKey);
            console.log("Encrypted result: ", result);
            const outputElement = document.getElementById("output");
            outputElement.textContent = "Encrypted result: " + result;
        }

        async function register() {
            const response = await fetch("http://localhost:8080/api/v1/registration");

            if (response.ok) {
                const data = await response.json();
                clientKey = Uint8Array.from(data.client_key);;
                console.log("Registration successful:", data);
            } else {
                console.error("Registration failed:", response.statusText);
            }
        }
        await register();

        document.getElementById("sendBtn").addEventListener("click", sendInput);
    </script>
</body>

</html>